openapi: 3.0.0
info:
  title: PDTM Agent API
  version: 1.0.0
  description: API for managing scans and enumerations in PDTM Agent

servers:
  - url: http://localhost:54321
    description: Local PDTM Agent server

paths:
  /status:
    get:
      summary: Get agent status
      description: Returns the current status of queued, completed and running tasks
      responses:
        '200':
          description: Status retrieved successfully
          content:
            text/plain:
              schema:
                type: string
                example: |
                  Queued Tasks:
                  Task scan-123: {}
                  
                  Completed Tasks:
                  Task enum-456: {}
                  
                  Running Tasks:
                  Task scan-789: {}

  /scans:
    post:
      summary: Create a new scan
      description: Creates a new scan with specified targets and templates
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScanRequest'
      responses:
        '200':
          description: Scan created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanResponse'
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /enumerations:
    post:
      summary: Create a new enumeration
      description: Creates a new enumeration with specified domains and configuration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnumerationRequest'
      responses:
        '200':
          description: Enumeration created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnumerationResponse'
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /enumerations/export:
    get:
      summary: Export enumerations
      description: Exports all enumerations for the current user
      responses:
        '200':
          description: Enumerations exported successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EnumerationExport'
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

components:
  schemas:
    ScanRequest:
      type: object
      required:
        - name
        - targets
      properties:
        name:
          type: string
          example: "test1 [pdtm-agent]"
        targets:
          type: array
          items:
            type: string
          example: ["scanme.sh"]
        templates:
          type: array
          items:
            type: string
          example: ["cves/2021/CVE-2021-1234"]

    ScanResponse:
      type: object
      properties:
        id:
          type: string
        message:
          type: string

    EnumerationRequest:
      type: object
      required:
        - name
        - root_domains
      properties:
        name:
          type: string
          example: "my-enumeration"
        root_domains:
          type: array
          items:
            type: string
          example: ["example.com"]
        steps:
          type: array
          items:
            type: string
          example: ["dns_resolve", "port_scan", "http_probe", "tls_scan"]
        exclude_targets:
          type: array
          items:
            type: string
          example: ["excluded.scanme.sh"]
        enumeration_ports:
          type: string
          example: "80,443,8080"
        enrichment_inputs:
          type: array
          items:
            type: string
          example: ["scanme.sh"]

    EnumerationResponse:
      type: object
      properties:
        id:
          type: string
        message:
          type: string

    EnumerationExport:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        assets:
          type: array
          items:
            type: string